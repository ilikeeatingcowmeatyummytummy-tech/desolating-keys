name: Consume License Key

on:
  workflow_dispatch:
    inputs:
      keyhash:
        description: "SHA256 hash of key"
        required: true

jobs:
  consume:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Remove key
        run: |
          grep -vx "${{ github.event.inputs.keyhash }}" keys.txt > keys.tmp || true
          mv keys.tmp keys.txt
          echo "${{ github.event.inputs.keyhash }}" >> used/used.log

      - name: Commit changes
        run: |
          git config user.name "KeyBot"
          git config user.email "keybot@github"
          git add keys.txt used/used.log
          git commit -m "Consume license key"
          git push
